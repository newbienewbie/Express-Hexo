<% if (config.disqus_shortname){ %>
<script>
  var disqus_shortname = '<%= config.disqus_shortname %>';
  <% if (page.permalink){ %>
  var disqus_url = '<%= page.permalink %>';
  <% } %>
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/<% if (page.comments) { %>embed.js<% } else { %>count.js<% } %>';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<% } %>

<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<script src="https://cdn.staticfile.org/jquery/2.0.3/jquery.min.js"></script>

<link rel="stylesheet" href="http://cdn.staticfile.org/KaTeX/0.7.1/katex.min.css" ></script>
<script src="http://cdn.staticfile.org/KaTeX/0.7.1/katex.min.js" ></script>

<script>
  // 查找所有 figure pre 节点 以备筛出数据公式
  var nodes=document.querySelectorAll("figure.plain pre");
  for(var i=0;i<nodes.length;i++){
    var node=nodes.item(i);
    // 魔术标记所在行 
    var first=node.children[0];
    if(first.textContent.trim().match(/%%(\s?)*KaTeX(\s?)*/i,)){
      // 移除魔术标记所在行
      first.remove();
      // 逐行渲染
      var lines=node.querySelectorAll("div.line").forEach(l=>{
          var f=l.textContent;
          katex.render(f, l);
      });
      // 消除父级嵌套 
      var tr=node.parentNode.parentElement;
      tr.innerHTML=node.innerHTML;
    }
  }
</script>

<% if (theme.fancybox){ %>
  <%- css('fancybox/jquery.fancybox') %>
  <%- js('fancybox/jquery.fancybox.pack') %>
<% } %>

<%- js('js/script') %>
